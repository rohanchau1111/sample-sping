plugins {
    id 'java'
    id 'maven-publish'
    id 'org.springframework.boot' version '3.3.2'
    id 'io.spring.dependency-management' version '1.1.6'
}

// group = 'ch.appuio.techlab'
// version = '0.1.1-SNAPSHOT'
// sourceCompatibility = JavaVersion.VERSION_17
// targetCompatibility = JavaVersion.VERSION_17

repositories {
    mavenCentral()
    maven {
        url = uri('http://172.27.225.231:8082/artifactory/gradle-dev-local/')
        allowInsecureProtocol = true
        credentials {
            username = 'admin'
            password = 'DevOps9@'
        }
    }
}

dependencies {
    compileOnly 'org.springframework.boot:spring-boot-starter-validation'
    implementation 'ch.appuio.techlab:artifactorytest:0.1.1-SNAPSHOT'
     implementation 'org.springframework.boot:spring-boot-starter'
     implementation 'org.springframework.boot:spring-boot-starter-actuator'
     implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
     implementation 'org.springframework.boot:spring-boot-starter-jdbc'
     implementation 'org.springframework.boot:spring-boot-starter-web'
     //implementation 'org.liquibase:liquibase-core'
     implementation 'io.micrometer:micrometer-registry-prometheus'
 //    implementation 'com.h2database:h2'
   //  implementation 'mysql:mysql-connector-java:8.0.33'
     implementation 'org.postgresql:postgresql'
     //testImplementation 'org.springframework.boot:spring-boot-starter-test'
    // testImplementation('org.springframework.boot:spring-boot-starter-test') {
    //     exclude group: 'org.junit.vintage', module: 'junit-vintage-engine'
    // }
    testImplementation 'junit:junit:4.13.2'
}

tasks.register('printDependencyPath') {
    doLast {
        configurations.runtimeClasspath.resolvedConfiguration.resolvedArtifacts.each { artifact ->
            if (artifact.file.name.endsWith('.jar')) {
                println "Dependency JAR file path: ${artifact.file.absolutePath}"
            }
        }
    }
}

tasks.register('copyDependencies', Copy) {
    from configurations.runtimeClasspath
    into "$buildDir/libs"
     println "$buildDir/libs"
}

tasks.named('build') {
    dependsOn 'copyDependencies'
    dependsOn 'printDependencyPath'
}

// publishing {
//     publications {
//         mavenJava(MavenPublication) {
//             from components.java
//             artifact tasks.named('bootJar')
//         }
//     }
//     repositories {
//         maven {
//             url = uri('http://172.27.225.231:8082/artifactory/gradle-dev-local/')
//             allowInsecureProtocol = true
//             credentials {
//                 username = 'admin'
//                 password = 'DevOps9@'
//             }
//         }
//     }
// }
